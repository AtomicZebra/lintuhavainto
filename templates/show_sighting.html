<!DOCTYPE html>
<html>

<head>
    <title>{{ sight.bird_species }}</title>
    <link rel="stylesheet" href="/static/style.css">
</head>

<body>
    <div class="header">
        <h1>{{ sight.bird_species }}</h1>
        <h2>{{ sight.time_added }}</h2>

    </div>
    {% for message in get_flashed_messages() %}
    <div class="info">
    <b>{{ message }}</b>
    {% endfor %}    
    </div>

    {% if session.user_id == sight.user_id %}
    <div class="subheader">
        <p>
            <a href="/edit_sighting/{{ sight.id }}">Muokkaa havaintoa</a> |
            <a href="/remove_sighting/{{ sight.id }}">Poista havainto</a>
        </p>   
        {% endif %}
    </div>

    <div class="subheader2">
        <p>
            {% for class in classes %}
            <b> {{class.title}} </b> </br>
            {{ class.value }}
            {% endfor %}
        </p>
        <p>
            <b>Lähiö - Kaupunki</b> </br>
            {{ sight.location }} - {{ sight.municipality }}
        </p>
        <p>
            <b>Lisätiedot</b> </br>
            {% if sight.additional_info %}
            {{ sight.additional_info }}
            {% else %}
            Ei lisätietoja
            {% endif %}
        </p>
        <p>
            <b>Havainnoitsija</b> </br>
            <a href="/user/{{ sight.user_id }}"> {{ sight.username }}</a>
        </p>
    </div>

    <div class="sign">  
        <h2>Keskustelu</h2>
        
        {% if messages %}
        <div class="message_bubble">
            {% for message in messages %}
            <small>{{ message.time_sent }}</small>
            <a href="/user/{{ message.user_id }}">{{ message.username }}</a>: 
            
            {% if message.user_id == session.user_id %}
            <a href="/remove_message/{{ message.id }}"> {{ message.message }}</a> </br>
            {% else %}
            {{ message.message }} </br>
            {% endif %}
            {% endfor %}
        </div>
        {% else %}
        Ei viestejä
        {% endif %}

        {% if session.username %}
        <form action="/new_message" method="post">
            <p>
                <b>Viesti</b> </br>
                <textarea name="message" rows="8" cols="40" maxlength="1000" required></textarea> </br>
            </p>
            <input type="hidden" name="sight_id" value="{{ sight.id }}">
            <input type="hidden" name="csrf_token" value="{{ session.csrf_token }}" />
        <input type="submit" value="Lähetä" />
        </form>
        {% endif %}
    </div>

    <div class="subheader2">
        <p>
            <a href="/">Takaisin</a>
        </p>
    </div>
</body>

</html>